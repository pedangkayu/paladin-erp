
CREATE VIEW `view_biling` AS select year(`data_faktur`.`created_at`) AS `tahun`,count(0) AS `jumlah` from `data_faktur` where (`data_faktur`.`type` = 2) group by year(`data_faktur`.`created_at`);


CREATE VIEW `view_count_data_retur_internal` AS select year(`data_retur`.`created_at`) AS `tahun`,count(0) AS `jumlah` from `data_retur` where (`data_retur`.`tipe` > 0) group by year(`data_retur`.`created_at`);


CREATE VIEW `view_count_gr` AS select year(`data_spbm`.`created_at`) AS `tahun`,count(0) AS `jumlah` from `data_spbm` group by year(`data_spbm`.`created_at`);


CREATE VIEW `view_count_item` AS select substr(`data_spb`.`created_at`,1,4) AS `tahun`,substr(`data_spb`.`no_spb`,1,3) AS `jenis_permintaan`,count(0) AS `jumlah`,count((case when (`data_spb`.`status` = 1) then `data_spb`.`status` end)) AS `baru`,count((case when (`data_spb`.`status` = 2) then `data_spb`.`status` end)) AS `proses`,count((case when (`data_spb`.`status` = 3) then `data_spb`.`status` end)) AS `selesai`,count((case when (`data_spb`.`status` = 4) then `data_spb`.`status` end)) AS `hapus`,count((case when (`data_spb`.`status` = 5) then `data_spb`.`status` end)) AS `selesai_manual` from `data_spb` group by substr(`data_spb`.`created_at`,1,4),substr(`data_spb`.`no_spb`,1,3);


CREATE VIEW `view_count_log_pasien` AS select year(`data_log_pasien`.`created_at`) AS `tahun`,count(0) AS `jumlah` from `data_log_pasien` group by cast(`data_log_pasien`.`created_at` as date);


CREATE VIEW `view_count_mutasi_item` AS select year(`data_mutasi_spb`.`created_at`) AS `tahun`,count(0) AS `jumlah` from `data_mutasi_spb` group by year(`data_mutasi_spb`.`created_at`);


CREATE VIEW `view_count_pinjaman_karyawan` AS select year(`data_loan`.`created_at`) AS `tahun`,count(0) AS `jumlah` from `data_loan` group by year(`data_loan`.`created_at`);


CREATE VIEW `view_count_po` AS select substr(`data_po`.`created_at`,1,4) AS `tahun`,count(0) AS `jumlah`,count((case when (`data_po`.`status` = 1) then `data_po`.`status` end)) AS `baru`,count((case when (`data_po`.`status` = 2) then `data_po`.`status` end)) AS `proses`,count((case when (`data_po`.`status` = 3) then `data_po`.`status` end)) AS `selesai`,count((case when (`data_po`.`status` = 4) then `data_po`.`status` end)) AS `hapus`,count((case when (`data_po`.`status` = 5) then `data_po`.`status` end)) AS `hapus_manual` from `data_po` group by substr(`data_po`.`created_at`,1,4);


CREATE VIEW `view_count_prq` AS select year(`data_prq`.`created_at`) AS `tahun`,count(0) AS `jumlah` from `data_prq` group by year(`data_prq`.`created_at`);


CREATE VIEW `view_count_resep` AS select year(`data_resep`.`created_at`) AS `tahun`,count(0) AS `jumlah` from `data_resep` group by year(`data_resep`.`created_at`);


CREATE VIEW `view_count_skb` AS select substr(`data_skb`.`created_at`,1,4) AS `tahun`,count(0) AS `jumlah`,count((case when (`data_skb`.`status` = 0) then `data_skb`.`status` end)) AS `hapus`,count((case when (`data_skb`.`status` = 1) then `data_skb`.`status` end)) AS `selesai`,count((case when (`data_skb`.`tipe` = 1) then `data_skb`.`status` end)) AS `Jumlah_obat`,count((case when (`data_skb`.`tipe` = 2) then `data_skb`.`status` end)) AS `Jumlah_barang` from `data_skb` group by substr(`data_skb`.`created_at`,1,4);


CREATE VIEW `view_count_smb` AS select substr(`data_mutasi_skb`.`created_at`,1,4) AS `tahun`,count(0) AS `jumlah`,count((case when (`data_mutasi_skb`.`status` = 0) then `data_mutasi_skb`.`status` end)) AS `hapus`,count((case when (`data_mutasi_skb`.`status` = 1) then `data_mutasi_skb`.`status` end)) AS `selesai`,count((case when (`data_mutasi_skb`.`tipe` = 1) then `data_mutasi_skb`.`status` end)) AS `Jumlah_obat`,count((case when (`data_mutasi_skb`.`tipe` = 2) then `data_mutasi_skb`.`status` end)) AS `Jumlah_barang` from `data_mutasi_skb` group by substr(`data_mutasi_skb`.`created_at`,1,4);


CREATE VIEW `view_count_sph` AS select substr(`data_sph`.`created_at`,1,4) AS `tahun`,count(0) AS `jumlah`,count((case when (`data_sph`.`status` = 0) then `data_sph`.`status` end)) AS `batal`,count((case when (`data_sph`.`status` = 1) then `data_sph`.`status` end)) AS `proses`,count((case when (`data_sph`.`status` = 2) then `data_sph`.`status` end)) AS `terpilih`,count((case when (`data_sph`.`status` = 3) then `data_sph`.`status` end)) AS `hapus_manual` from `data_sph` group by substr(`data_sph`.`created_at`,1,4);

CREATE VIEW `view_count_sph_grup` AS select year(`data_sph_grup`.`created_at`) AS `tahun`,count(0) AS `jumlah` from `data_sph_grup` group by year(`data_sph_grup`.`created_at`);


CREATE VIEW `view_count_treatment` AS select year(`data_treatment`.`created_at`) AS `tahun`,count(0) AS `jumlah` from `data_treatment` group by year(`data_treatment`.`created_at`);


CREATE VIEW `view_dashboard_keuangan` AS select (select sum(`data_hutang_vendor`.`total`) from `data_hutang_vendor` where (`data_hutang_vendor`.`status` = 1)) AS `total_hutang`,(select sum(`data_hutang_vendor`.`total`) from `data_hutang_vendor` where ((`data_hutang_vendor`.`status` = 1) and (cast(`data_hutang_vendor`.`tgl_jatuh_tempo` as date) < cast(now() as date)))) AS `hutang_jth_tempo`,(select `view_piutang`.`total_piutang` from `view_piutang`) AS `total_piutang`,(select `view_piutang`.`total_piutang_jth_tempo` from `view_piutang`) AS `total_piutang_jth_tempo`;


CREATE VIEW `view_faktur_pembelian` AS select year(`data_faktur`.`created_at`) AS `tahun`,count(0) AS `jumlah` from `data_faktur` where (`data_faktur`.`type` in (1,3)) group by year(`data_faktur`.`created_at`);


CREATE VIEW `view_karyawan_detail` AS select `data_karyawan`.`id_karyawan` AS `id_karyawan`,`data_karyawan`.`id_profesi` AS `id_profesi`,`data_karyawan`.`NIK` AS `NIK`,`data_karyawan`.`nm_depan` AS `nm_depan`,`data_karyawan`.`nm_belakang` AS `nm_belakang`,`data_karyawan`.`email` AS `email`,`data_karyawan`.`hp` AS `hp`,`data_karyawan`.`tempat_lahir` AS `tempat_lahir`,`data_karyawan`.`tgl_lahir` AS `tgl_lahir`,`data_karyawan`.`foto` AS `foto`,`data_karyawan`.`jabatan` AS `jabatan`,`data_karyawan`.`tgl_bergabung` AS `tgl_bergabung`,`data_karyawan`.`id_departemen` AS `id_departemen`,`ref_profesi`.`nama_profesi` AS `nama_profesi`,`data_departemen`.`kd_departemen` AS `kd_departemen`,`data_departemen`.`nm_departemen` AS `nm_departemen`,`ref_jabatan`.`nm_jabatan` AS `nm_jabatan` from (((`data_karyawan` join `data_departemen` on((`data_karyawan`.`id_departemen` = `data_departemen`.`id_departemen`))) join `ref_profesi` on((`data_karyawan`.`id_profesi` = `ref_profesi`.`id_profesi`))) join `ref_jabatan` on((`data_karyawan`.`jabatan` = `ref_jabatan`.`id`)));


CREATE VIEW `view_karyawan_honor` AS select `data_karyawan`.`id_karyawan` AS `id_karyawan`,`data_karyawan`.`id_profesi` AS `id_profesi`,`data_karyawan`.`NIK` AS `NIK`,`data_karyawan`.`nm_depan` AS `nm_depan`,`data_karyawan`.`nm_belakang` AS `nm_belakang`,`data_karyawan`.`telp` AS `telp`,`data_karyawan`.`email` AS `email`,`data_karyawan`.`sex` AS `sex`,`data_karyawan`.`hp` AS `hp`,`data_karyawan`.`tempat_lahir` AS `tempat_lahir`,`data_karyawan`.`tgl_lahir` AS `tgl_lahir`,`data_karyawan`.`foto` AS `foto`,`data_karyawan`.`jabatan` AS `jabatan`,`data_karyawan`.`alamat` AS `alamat`,`data_karyawan`.`agama` AS `agama`,`data_karyawan`.`pendidikan` AS `pendidikan`,`data_karyawan`.`id_status` AS `id_status`,`data_karyawan`.`tgl_bergabung` AS `tgl_bergabung`,`data_karyawan`.`id_departemen` AS `id_departemen`,`data_karyawan`.`created_at` AS `created_at`,`data_karyawan`.`updated_at` AS `updated_at`,`ref_komponen_honor`.`nm_komponen_honor` AS `nm_komponen_honor`,`data_karyawan_honor`.`aktif` AS `aktif`,`data_karyawan_honor`.`nilai` AS `nilai`,`data_karyawan_honor`.`id_karyawan_honor` AS `id_karyawan_honor`,`data_karyawan_honor`.`id_komponen_honor` AS `id_komponen_honor`,`ref_komponen_honor`.`tipe` AS `tipe`,`ref_komponen_honor`.`keterangan` AS `keterangan`,`ref_komponen_honor`.`status` AS `status` from ((`data_karyawan` join `data_karyawan_honor` on((`data_karyawan_honor`.`id_karyawan` = `data_karyawan`.`id_karyawan`))) join `ref_komponen_honor` on((`data_karyawan_honor`.`id_komponen_honor` = `ref_komponen_honor`.`id_komponen_honor`)));


CREATE VIEW `view_krs` AS select `data_rawat_inap`.`id_antrian` AS `id_antrian`,`data_rawat_inap`.`id_status_jenis_kedatangan` AS `id_status_jenis_kedatangan`,`data_rawat_inap`.`rencana_mrs` AS `rencana_mrs`,`data_rawat_inap`.`status_masuk_rinap` AS `status_masuk_rinap`,`data_rawat_inap`.`status_keluar_rinap` AS `status_keluar_rinap`,`data_rawat_inap`.`ket_mrs` AS `ket_mrs`,`data_rawat_inap_pakai`.`tgl_pakai` AS `tgl_pakai`,`data_rawat_inap_pakai`.`tgl_mulai_tagihan` AS `tgl_mulai_tagihan`,`data_rawat_inap_pakai`.`id_kamar` AS `id_kamar`,`data_rawat_inap_pakai`.`daftar_rinap` AS `daftar_rinap`,`data_rawat_inap_pakai`.`selesai_rinap` AS `selesai_rinap`,`data_rawat_inap`.`id_rinap` AS `id_rinap`,`ref_kamar`.`nm_kamar` AS `nm_kamar`,`data_rawat_inap`.`id_pasien` AS `id_pasien`,`data_pasien`.`nama_pasien` AS `nama_pasien`,`data_pasien`.`noktp_pasien` AS `noktp_pasien`,`data_pasien`.`noasuransi_pasien` AS `noasuransi_pasien`,`data_pasien`.`jk_pasien` AS `jk_pasien`,`data_pasien`.`tgllahir_pasien` AS `tgllahir_pasien`,`data_pasien`.`tempatlahir_pasien` AS `tempatlahir_pasien` from (((`data_rawat_inap` join `data_rawat_inap_pakai` on((`data_rawat_inap_pakai`.`id_rinap` = `data_rawat_inap`.`id_rinap`))) join `ref_kamar` on((`data_rawat_inap_pakai`.`id_kamar` = `ref_kamar`.`id_kamar`))) join `data_pasien` on((`data_rawat_inap`.`id_pasien` = `data_pasien`.`id_pasien_hc`)));


CREATE VIEW `view_laporan_shift` AS select `e`.`keterangan` AS `keterangan`,`c`.`nomor_faktur` AS `nomor_faktur`,`d`.`nama_pasien` AS `nama_pasien`,`a`.`created_at` AS `tgl_kwitansi`,`b`.`nm_depan` AS `nm_depan`,`b`.`nm_belakang` AS `nm_belakang`,`a`.`jumlah` AS `jumlah`,`a`.`id_karyawan` AS `id_karyawan` from ((((`data_jurnal_pembayaran` `a` join `data_karyawan` `b` on((`b`.`id_karyawan` = `a`.`id_karyawan`))) join `data_faktur` `c` on((`c`.`id_faktur` = `a`.`id_faktur`))) join `data_pasien` `d` on((`d`.`id_pasien_hc` = `c`.`id_pasien`))) join `ref_payment_method_item` `e` on((`e`.`id_payment_method_item` = `a`.`id_payment_method_item`))) order by `e`.`keterangan` desc,`a`.`created_at` desc;


CREATE VIEW `view_log_pasien` AS select year(`data_log_pasien`.`created_at`) AS `tahun`,count(0) AS `jumlah` from `data_log_pasien` group by cast(`data_log_pasien`.`created_at` as date);


CREATE VIEW `view_neraca_saldo` AS select `b`.`kode` AS `kode`,`b`.`nm_coa` AS `nm_coa`,sum(`a`.`debit`) AS `debit`,sum(`a`.`kredit`) AS `kredit`,if((`a`.`debit` > `a`.`kredit`),sum((`a`.`debit` - `a`.`kredit`)),0) AS `saldo_debit`,if((`a`.`kredit` > `a`.`debit`),sum((`a`.`kredit` - `a`.`debit`)),0) AS `saldo_kredit` from (`data_jurnal` `a` join `ref_coa` `b` on((`b`.`id_coa` = `a`.`id_coa`))) group by `a`.`id_coa` order by `b`.`kode`;


CREATE VIEW `view_piutang` AS select (if(((select sum(`data_piutang_pasien`.`total`) from `data_piutang_pasien` where (`data_piutang_pasien`.`status` = 1)) > 0),(select sum(`data_piutang_pasien`.`total`) from `data_piutang_pasien` where (`data_piutang_pasien`.`status` = 1)),0) + if(((select sum(`data_piutang_custommer`.`total`) from `data_piutang_custommer` where (`data_piutang_custommer`.`status` = 1)) > 0),(select sum(`data_piutang_custommer`.`total`) from `data_piutang_custommer` where (`data_piutang_custommer`.`status` = 1)),0)) AS `total_piutang`,(if(((select sum(`data_piutang_pasien`.`total`) from `data_piutang_pasien` where ((`data_piutang_pasien`.`status` = 1) and (cast(`data_piutang_pasien`.`tgl_jatuh_tempo` as date) < cast(now() as date)))) > 0),(select sum(`data_piutang_pasien`.`total`) from `data_piutang_pasien` where ((`data_piutang_pasien`.`status` = 1) and (cast(`data_piutang_pasien`.`tgl_jatuh_tempo` as date) < cast(now() as date)))),0) + if(((select sum(`data_piutang_custommer`.`total`) from `data_piutang_custommer` where ((`data_piutang_custommer`.`status` = 1) and (cast(`data_piutang_custommer`.`tgl_jatuh_tempo` as date) < cast(now() as date)))) > 0),(select sum(`data_piutang_custommer`.`total`) from `data_piutang_custommer` where ((`data_piutang_custommer`.`status` = 1) and (cast(`data_piutang_custommer`.`tgl_jatuh_tempo` as date) < cast(now() as date)))),0)) AS `total_piutang_jth_tempo`;

CREATE VIEW `view_report_faktur_pembelian` AS select `data_vendor`.`id_vendor` AS `id_vendor`,`data_vendor`.`nm_vendor` AS `nm_vendor`,`data_vendor`.`no_npwp` AS `no_npwp`,`data_vendor`.`pemilik` AS `pemilik`,`data_faktur`.`nomor_faktur` AS `nomor_faktur`,`data_faktur`.`id_faktur` AS `id_faktur`,`data_faktur`.`type` AS `type`,`data_faktur`.`tgl_faktur` AS `tgl_faktur`,`data_faktur`.`id_po` AS `id_po`,`data_faktur`.`ppn` AS `ppn`,`data_faktur`.`diskon` AS `diskon`,`data_faktur`.`adjustment` AS `adjustment`,`data_faktur`.`subtotal` AS `subtotal`,`data_faktur`.`total` AS `total`,`data_faktur`.`amount_due` AS `amount_due`,`data_faktur`.`status_bayar` AS `status_bayar` from (`data_vendor` join `data_faktur` on((`data_faktur`.`id_vendor` = `data_vendor`.`id_vendor`)));

CREATE VIEW `view_report_jasa_medis` AS select `data_faktur`.`id_faktur` AS `id_faktur`,`data_faktur_pasien`.`tarif_dr` AS `tarif_dr`,`data_faktur_pasien`.`id_treatment_item` AS `id_treatment_item`,`data_treatment_item`.`service_kode` AS `service_kode`,`ref_service_kode`.`nm_service` AS `nm_service`,`data_karyawan`.`nm_depan` AS `nm_depan`,`data_karyawan`.`nm_belakang` AS `nm_belakang`,`data_pasien`.`id_pasien_hc` AS `id_pasien_hc`,`data_pasien`.`nama_pasien` AS `nama_pasien`,`data_treatment_dokter`.`jabatan` AS `jabatan`,`data_treatment_dokter`.`id_dokter` AS `id_dokter`,`data_treatment`.`created_at` AS `created_at`,`data_treatment`.`updated_at` AS `updated_at`,`data_treatment`.`tgl_input` AS `tgl_input`,`ref_gudang`.`nm_gudang` AS `nm_gudang` from ((((((((`data_faktur` left join `data_faktur_pasien` on((`data_faktur_pasien`.`id_faktur` = `data_faktur`.`id_faktur`))) left join `data_treatment_item` on((`data_faktur_pasien`.`id_treatment_item` = `data_treatment_item`.`id_treatment_item`))) left join `data_treatment_dokter` on((`data_treatment_dokter`.`id_treatment_item` = `data_treatment_item`.`id_treatment_item`))) join `ref_service_kode` on((`data_treatment_item`.`service_kode` = `ref_service_kode`.`service_kode`))) left join `data_karyawan` on((`data_treatment_dokter`.`id_dokter` = `data_karyawan`.`id_karyawan`))) join `data_treatment` on((`data_treatment_item`.`id_treatment` = `data_treatment`.`id_treatment`))) join `data_pasien` on((`data_treatment`.`id_pasien` = `data_pasien`.`id_pasien_hc`))) join `ref_gudang` on((`data_treatment`.`id_unit` = `ref_gudang`.`id_gudang`))) where (`data_treatment_dokter`.`id_dokter` <> '0');

CREATE VIEW `view_retur_resep` AS select year(`data_retur_resep`.`created_at`) AS `tahun`,count(0) AS `jumlah` from `data_retur_resep` group by year(`data_retur_resep`.`created_at`);

CREATE VIEW `view_rugi_laba` AS select year(`a`.`tanggal`) AS `tahun`,((select sum((`a`.`kredit` - `a`.`debit`)) from (`data_jurnal` `a` join `ref_coa` `b` on((`b`.`id_coa` = `a`.`id_coa`))) where (`b`.`coa_kategori` = 4)) - (select sum((`a`.`debit` - `a`.`kredit`)) from (`data_jurnal` `a` join `ref_coa` `b` on((`b`.`id_coa` = `a`.`id_coa`))) where (`b`.`coa_kategori` = 5))) AS `rugi_laba` from (`data_jurnal` `a` join `ref_coa` `b` on((`b`.`id_coa` = `b`.`id_coa`))) where (`b`.`coa_kategori` in (4,5)) group by year(`a`.`tanggal`);


CREATE VIEW `view_rugi_laba_perbulan` AS select month(`a`.`tanggal`) AS `bulan`,year(`a`.`tanggal`) AS `tahun`,((select sum((`ab`.`kredit` - `ab`.`debit`)) from (`data_jurnal` `ab` join `ref_coa` `ba` on((`ba`.`id_coa` = `ab`.`id_coa`))) where ((`ba`.`coa_kategori` = 4) and (month(`ab`.`tanggal`) = month(`a`.`tanggal`)) and (year(`ab`.`tanggal`) = year(`a`.`tanggal`))) group by month(`ab`.`tanggal`)) - (select sum((`ac`.`debit` - `ac`.`kredit`)) from (`data_jurnal` `ac` join `ref_coa` `bc` on((`bc`.`id_coa` = `ac`.`id_coa`))) where ((`bc`.`coa_kategori` = 5) and (month(`ac`.`tanggal`) = month(`a`.`tanggal`)) and (year(`ac`.`tanggal`) = year(`a`.`tanggal`))) group by month(`ac`.`tanggal`))) AS `rugi_laba`,((select sum((`ca`.`kredit` - `ca`.`debit`)) from (`data_jurnal` `ca` join `ref_coa` `cb` on((`cb`.`id_coa` = `ca`.`id_coa`))) where ((`cb`.`coa_kategori` = 6) and (month(`ca`.`tanggal`) = month(`a`.`tanggal`)) and (year(`ca`.`tanggal`) = year(`a`.`tanggal`))) group by month(`ca`.`tanggal`)) - (select sum((`da`.`debit` - `da`.`kredit`)) from (`data_jurnal` `da` join `ref_coa` `db` on((`db`.`id_coa` = `da`.`id_coa`))) where ((`db`.`coa_kategori` = 7) and (month(`da`.`tanggal`) = month(`a`.`tanggal`)) and (year(`da`.`tanggal`) = year(`a`.`tanggal`))) group by month(`da`.`tanggal`))) AS `rugi_laba_luar_usaha`,(select sum((`ea`.`debit` - `ea`.`kredit`)) from (`data_jurnal` `ea` join `ref_coa` `eb` on((`eb`.`id_coa` = `ea`.`id_coa`))) where ((`eb`.`coa_kategori` = 8) and (month(`ea`.`tanggal`) = month(`a`.`tanggal`)) and (year(`ea`.`tanggal`) = year(`a`.`tanggal`))) group by year(`ea`.`tanggal`)) AS `pajak` from (`data_jurnal` `a` join `ref_coa` `b` on((`b`.`id_coa` = `a`.`id_coa`))) where (`b`.`coa_kategori` in (4,5,6,7,8)) group by month(`a`.`tanggal`);


CREATE VIEW `view_rugi_laba_perhari` AS select cast(`a`.`tanggal` as date) AS `tanggal`,((select sum((`ab`.`kredit` - `ab`.`debit`)) from (`data_jurnal` `ab` join `ref_coa` `ba` on((`ba`.`id_coa` = `ab`.`id_coa`))) where ((`ba`.`coa_kategori` = 4) and (cast(`ab`.`tanggal` as date) = cast(`a`.`tanggal` as date))) group by cast(`ab`.`tanggal` as date)) - (select sum((`ac`.`debit` - `ac`.`kredit`)) from (`data_jurnal` `ac` join `ref_coa` `bc` on((`bc`.`id_coa` = `ac`.`id_coa`))) where ((`bc`.`coa_kategori` = 5) and (cast(`ac`.`tanggal` as date) = cast(`a`.`tanggal` as date))) group by cast(`ac`.`tanggal` as date))) AS `rugi_laba`,((select sum((`ca`.`kredit` - `ca`.`debit`)) from (`data_jurnal` `ca` join `ref_coa` `cb` on((`cb`.`id_coa` = `ca`.`id_coa`))) where ((`cb`.`coa_kategori` = 6) and (cast(`ca`.`tanggal` as date) = cast(`a`.`tanggal` as date))) group by cast(`ca`.`tanggal` as date)) - (select sum((`da`.`debit` - `da`.`kredit`)) from (`data_jurnal` `da` join `ref_coa` `db` on((`db`.`id_coa` = `da`.`id_coa`))) where ((`db`.`coa_kategori` = 7) and (cast(`da`.`tanggal` as date) = cast(`a`.`tanggal` as date))) group by cast(`da`.`tanggal` as date))) AS `rugi_laba_luar_usaha`,(select sum((`ea`.`debit` - `ea`.`kredit`)) from (`data_jurnal` `ea` join `ref_coa` `eb` on((`eb`.`id_coa` = `ea`.`id_coa`))) where ((`eb`.`coa_kategori` = 8) and (cast(`ea`.`tanggal` as date) = cast(`a`.`tanggal` as date))) group by cast(`ea`.`tanggal` as date)) AS `pajak` from (`data_jurnal` `a` join `ref_coa` `b` on((`b`.`id_coa` = `a`.`id_coa`))) where (`b`.`coa_kategori` in (4,5,6,7,8)) group by cast(`a`.`tanggal` as date);


CREATE VIEW `view_rugi_laba_tahunan` AS select year(`a`.`tanggal`) AS `tahun`,((select sum((`ab`.`kredit` - `ab`.`debit`)) from (`data_jurnal` `ab` join `ref_coa` `ba` on((`ba`.`id_coa` = `ab`.`id_coa`))) where ((`ba`.`coa_kategori` = 4) and (year(`ab`.`tanggal`) = year(`a`.`tanggal`))) group by year(`ab`.`tanggal`)) - (select sum((`ac`.`debit` - `ac`.`kredit`)) from (`data_jurnal` `ac` join `ref_coa` `bc` on((`bc`.`id_coa` = `ac`.`id_coa`))) where ((`bc`.`coa_kategori` = 5) and (year(`ac`.`tanggal`) = year(`a`.`tanggal`))) group by year(`ac`.`tanggal`))) AS `rugi_laba`,((select sum((`ca`.`kredit` - `ca`.`debit`)) from (`data_jurnal` `ca` join `ref_coa` `cb` on((`cb`.`id_coa` = `ca`.`id_coa`))) where ((`cb`.`coa_kategori` = 6) and (year(`ca`.`tanggal`) = year(`a`.`tanggal`))) group by year(`ca`.`tanggal`)) - (select sum((`da`.`debit` - `da`.`kredit`)) from (`data_jurnal` `da` join `ref_coa` `db` on((`db`.`id_coa` = `da`.`id_coa`))) where ((`db`.`coa_kategori` = 7) and (year(`da`.`tanggal`) = year(`a`.`tanggal`))) group by year(`da`.`tanggal`))) AS `rugi_laba_luar_usaha`,(select sum((`ea`.`debit` - `ea`.`kredit`)) from (`data_jurnal` `ea` join `ref_coa` `eb` on((`eb`.`id_coa` = `ea`.`id_coa`))) where ((`eb`.`coa_kategori` = 8) and (year(`ea`.`tanggal`) = year(`a`.`tanggal`))) group by year(`ea`.`tanggal`)) AS `pajak` from (`data_jurnal` `a` join `ref_coa` `b` on((`b`.`id_coa` = `a`.`id_coa`))) where (`b`.`coa_kategori` in (4,5,6,7,8)) group by year(`a`.`tanggal`);

CREATE VIEW `view_stok_akhir` AS select `db`.`kode` AS `kode`,`db`.`nm_barang` AS `nm_barang`,`db`.`harga_beli` AS `harga_beli`,`rs`.`nm_satuan` AS `satuan`,(((sum(`dig`.`in`) - sum(`dig`.`out`)) + max(`db`.`in`)) - max(`db`.`out`)) AS `jumlah`,(`db`.`harga_beli` * (((sum(`dig`.`in`) - sum(`dig`.`out`)) + max(`db`.`in`)) - max(`db`.`out`))) AS `total`,(max(`db`.`in`) - max(`db`.`out`)) AS `Gudang Besar`,sum((case when (`rg`.`nm_gudang` = 'Gudang Logistik') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Gudang Logistik`,sum((case when (`rg`.`nm_gudang` = 'Farmasi') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Farmasi`,sum((case when (`rg`.`nm_gudang` = 'Poli Bedah') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Poli Bedah`,sum((case when (`rg`.`nm_gudang` = 'Poli Ginaecology') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Poli Ginaecology`,sum((case when (`rg`.`nm_gudang` = 'Radiologi') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Radiologi`,sum((case when (`rg`.`nm_gudang` = 'UGD') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `UGD`,sum((case when (`rg`.`nm_gudang` = 'Rawat inap') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Rawat inap`,sum((case when (`rg`.`nm_gudang` = 'Poli Hematologi') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Poli Hematologi`,sum((case when (`rg`.`nm_gudang` = 'Kemoterapi') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Kemoterapi`,sum((case when (`rg`.`nm_gudang` = 'Ruang Oplos') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Ruang Oplos`,sum((case when (`rg`.`nm_gudang` = 'Kamar Operasi') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Kamar Operasi`,sum((case when (`rg`.`nm_gudang` = 'Recovery Room') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Recovery Room`,sum((case when (`rg`.`nm_gudang` = 'Pathologi Anatomi') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Pathologi Anatomi`,sum((case when (`rg`.`nm_gudang` = 'Paptest + FNA') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Paptest + FNA`,sum((case when (`rg`.`nm_gudang` = 'Dapur') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Dapur`,sum((case when (`rg`.`nm_gudang` = 'UPS') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `UPS`,sum((case when (`rg`.`nm_gudang` = 'Rekam Medik') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Rekam Medik`,sum((case when (`rg`.`nm_gudang` = 'Mini counter poli bedah') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Mini counter poli bedah`,sum((case when (`rg`.`nm_gudang` = 'Cafe') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Cafe`,sum((case when (`rg`.`nm_gudang` = 'Keuangan') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Keuangan`,sum((case when (`rg`.`nm_gudang` = 'Call Centre') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Call Centre`,sum((case when (`rg`.`nm_gudang` = 'SDM') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `SDM`,sum((case when (`rg`.`nm_gudang` = 'Mutu') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Mutu`,sum((case when (`rg`.`nm_gudang` = 'Sekretariat') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Sekretariat`,sum((case when (`rg`.`nm_gudang` = 'Patient Assistance') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Patient Assistance`,sum((case when (`rg`.`nm_gudang` = 'Apotik') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Apotik`,sum((case when (`rg`.`nm_gudang` = 'Pengembangan Bisnis') then (`dig`.`in` - `dig`.`out`) else 0 end)) AS `Pengembangan Bisnis` from (((`data_barang` `db` left join `data_item_gudang` `dig` on((`dig`.`id_barang` = `db`.`id_barang`))) left join `ref_gudang` `rg` on((`rg`.`id_gudang` = `dig`.`id_gudang`))) left join `ref_satuan` `rs` on((`db`.`id_satuan` = `rs`.`id_satuan`))) group by `db`.`nm_barang`,`rs`.`nm_satuan` having (((max(`db`.`in`) - max(`db`.`out`)) > 0) or ((((sum(`dig`.`in`) - sum(`dig`.`out`)) + max(`db`.`in`)) - max(`db`.`out`)) > 0));

CREATE VIEW `view_total_harta_pertahun` AS select year(`a`.`tanggal`) AS `tahun`,(select sum((`ab`.`debit` - `ab`.`kredit`)) from (`data_jurnal` `ab` join `ref_coa` `ba` on((`ba`.`id_coa` = `ab`.`id_coa`))) where ((`ba`.`coa_kategori` = 1) and (year(`ab`.`tanggal`) = year(`a`.`tanggal`))) group by year(`ab`.`tanggal`)) AS `total_harta` from (`data_jurnal` `a` join `ref_coa` `b` on((`b`.`id_coa` = `b`.`id_coa`))) where (`b`.`coa_kategori` = 1) group by year(`a`.`tanggal`);
